<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cortex App Studio | PAPI Central</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="papi-key-loader.js"></script>
    <script src="trial-system.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap');
        
        :root {
            --cortex-purple: #9333ea;
            --cortex-blue: #3b82f6;
            --papi-blue: #38bdf8;
            --bg-deep: #050a14;
            --glass: rgba(13, 17, 23, 0.8);
            --border: rgba(255, 255, 255, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #1e1b4b 0%, #0f172a 100%);
            color: #eef2f6;
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 25px;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 16px;
            position: relative;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(56, 189, 248, 0.2);
            border: 1px solid var(--papi-blue);
            color: var(--papi-blue);
            padding: 8px 16px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: var(--papi-blue);
            color: #000;
            transform: translateY(-2px);
        }

        h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--cortex-purple), var(--cortex-blue));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .subtitle { color: #94a3b8; font-size: 1rem; }

        .split-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        @media (max-width: 1024px) {
            .split-view { grid-template-columns: 1fr; }
        }

        .panel {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(147, 51, 234, 0.3);
            border-radius: 12px;
            padding: 20px;
        }

        .panel h2 {
            font-size: 1.3rem;
            color: var(--cortex-purple);
            margin-bottom: 15px;
        }

        label {
            display: block;
            color: #cbd5e1;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        textarea {
            width: 100%;
            padding: 12px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(147, 51, 234, 0.3);
            border-radius: 8px;
            color: white;
            font-family: inherit;
            font-size: 14px;
            min-height: 80px;
            resize: vertical;
            margin-bottom: 12px;
        }

        textarea:focus {
            outline: none;
            border-color: var(--cortex-purple);
        }

        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--cortex-purple), var(--cortex-blue));
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(147, 51, 234, 0.4);
        }

        .btn-full { width: 100%; }

        .code-output {
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(147, 51, 234, 0.2);
            border-radius: 8px;
            padding: 12px;
            color: #64ffda;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 12px;
        }

        .preview-frame {
            width: 100%;
            height: 400px;
            background: white;
            border: 2px solid rgba(147, 51, 234, 0.3);
            border-radius: 8px;
            margin-top: 12px;
        }

        .device-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .device-btn {
            flex: 1;
            padding: 8px;
            background: rgba(55, 65, 81, 0.5);
            border: 1px solid rgba(147, 51, 234, 0.3);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .device-btn.active {
            background: var(--cortex-purple);
            border-color: var(--cortex-purple);
        }

        .quick-templates {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .template-btn {
            padding: 6px 12px;
            background: rgba(55, 65, 81, 0.5);
            border: 1px solid rgba(147, 51, 234, 0.3);
            color: #cbd5e1;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .template-btn:hover {
            background: rgba(147, 51, 234, 0.3);
            transform: none;
        }

        .deploy-section {
            background: rgba(34, 197, 94, 0.1);
            border: 2px solid rgba(34, 197, 94, 0.4);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .deploy-section h2 {
            color: #22c55e;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .deploy-btn {
            padding: 12px 40px;
            background: linear-gradient(135deg, #22c55e, #10b981);
            font-size: 16px;
            margin-top: 15px;
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .button-group button {
            flex: 1;
            padding: 8px;
            font-size: 12px;
        }

        .voice-input-wrapper {
            position: relative;
        }

        .voice-btn {
            position: absolute;
            right: 10px;
            top: 10px;
            background: rgba(147, 51, 234, 0.2);
            border: 2px solid var(--cortex-purple);
            color: var(--cortex-purple);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            padding: 0;
        }

        .voice-btn:hover {
            background: var(--cortex-purple);
            color: white;
            transform: scale(1.05);
        }

        .voice-btn.recording {
            background: #ef4444;
            border-color: #ef4444;
            color: white;
            animation: pulse-record 1s infinite;
        }

        @keyframes pulse-record {
            0%, 100% { box-shadow: 0 0 10px rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.8); }
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: linear-gradient(135deg, #1e1b4b, #0f172a);
            border: 2px solid var(--cortex-purple);
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-content h2 {
            color: var(--cortex-purple);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .modal-content .request-preview {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(147, 51, 234, 0.3);
            border-radius: 8px;
            padding: 15px;
            color: #cbd5e1;
            margin: 15px 0;
            font-size: 16px;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .modal-actions button {
            flex: 1;
            padding: 12px;
            font-size: 15px;
        }

        .btn-cancel {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            color: #ef4444;
        }

        .btn-cancel:hover {
            background: #ef4444;
            color: white;
        }

        .btn-confirm {
            background: linear-gradient(135deg, #22c55e, #10b981);
        }

        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Back to PAPI
            </a>
            <h1><i class="fas fa-magic"></i> Cortex App Studio</h1>
            <p class="subtitle">Build ‚Üí Preview ‚Üí Deploy - AI-Powered App Creation</p>
        </div>

        <!-- Main Split View -->
        <div class="split-view">
            <!-- LEFT: AI Generation -->
            <div class="panel">
                <h2><i class="fas fa-brain"></i> AI App Generator</h2>
                
                <label>What do you want to build? <span style="font-size: 11px; color: #94a3b8;">(Type or speak)</span></label>
                <div class="voice-input-wrapper">
                    <textarea 
                        id="appRequest" 
                        placeholder="Example: Build me a todo app with dark mode and localStorage"
                        style="padding-right: 60px;"
                    ></textarea>
                    <button id="voiceBtn" class="voice-btn" onclick="toggleVoiceInput()" title="Voice Input - Always Available (Auto-stops after 5 sec silence)">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
                
                <button onclick="generateApp()" class="btn-full">
                    <i class="fas fa-robot"></i> Generate App with AI
                </button>

                <div style="margin-top: 15px;">
                    <label style="font-weight: bold;">Generated Code:</label>
                    <div id="codeOutput" class="code-output">// Your generated app code will appear here...
// Try it: Click a template below or describe what you want!</div>
                </div>

                <div style="margin-top: 12px;">
                    <p style="font-size: 12px; color: #94a3b8; margin-bottom: 8px;">Quick Templates:</p>
                    <div class="quick-templates">
                        <button class="template-btn" onclick="quickGen('todo app')">üìù Todo List</button>
                        <button class="template-btn" onclick="quickGen('calculator')">üî¢ Calculator</button>
                        <button class="template-btn" onclick="quickGen('countdown timer')">‚è±Ô∏è Timer</button>
                        <button class="template-btn" onclick="quickGen('landing page')">üåê Landing Page</button>
                    </div>
                </div>
            </div>

            <!-- RIGHT: Live Preview -->
            <div class="panel">
                <h2><i class="fas fa-eye"></i> Live Preview Browser</h2>

                <div class="device-buttons">
                    <button class="device-btn active" onclick="setDevice('desktop')">
                        <i class="fas fa-desktop"></i> Desktop
                    </button>
                    <button class="device-btn" onclick="setDevice('tablet')">
                        <i class="fas fa-tablet-alt"></i> Tablet
                    </button>
                    <button class="device-btn" onclick="setDevice('mobile')">
                        <i class="fas fa-mobile-alt"></i> Mobile
                    </button>
                </div>

                <iframe 
                    id="previewFrame" 
                    class="preview-frame"
                    sandbox="allow-scripts allow-same-origin"
                    srcdoc="<html><body style='display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);color:white;'><div style='text-align:center;'><h1>üé® Preview Ready</h1><p>Generate an app to see it here!</p></div></body></html>"
                ></iframe>

                <div class="button-group">
                    <button onclick="refreshPreview()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button onclick="openInNewTab()">
                        <i class="fas fa-external-link-alt"></i> New Tab
                    </button>
                    <button onclick="copyCode()">
                        <i class="fas fa-copy"></i> Copy Code
                    </button>
                </div>
            </div>
        </div>

        <!-- Deploy Section -->
        <div class="deploy-section">
            <h2><i class="fas fa-rocket"></i> Ready to Deploy?</h2>
            <p style="color: #cbd5e1;">Test your app in the preview browser, then deploy with one click!</p>
            <button class="deploy-btn" onclick="deployApp()">
                <i class="fas fa-cloud-upload-alt"></i> Deploy to Web
            </button>
            <button class="deploy-btn" onclick="showSavedApps()" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); margin-left: 10px;">
                <i class="fas fa-history"></i> Saved Apps
            </button>
        </div>
        
        <!-- Saved Apps History Modal -->
        <div id="savedAppsModal" class="modal-overlay hidden">
            <div class="modal-content" style="max-width: 700px;">
                <h2><i class="fas fa-history"></i> Your Saved Apps</h2>
                <p style="color: #94a3b8; margin-bottom: 15px; font-size: 14px;">
                    Apps are automatically saved to browser storage and your Downloads folder
                </p>
                <div id="savedAppsList" style="max-height: 400px; overflow-y: auto; margin: 20px 0;"></div>
                <div class="modal-actions">
                    <button class="btn-confirm" onclick="closeSavedApps()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Voice Confirmation Modal -->
    <div id="confirmModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2><i class="fas fa-check-circle"></i> Confirm Voice Command</h2>
            <p style="color: #94a3b8; margin-bottom: 10px;">I heard you say:</p>
            <div class="request-preview" id="voicePreview"></div>
            <p style="color: #94a3b8; font-size: 14px; margin-top: 10px;">
                <i class="fas fa-info-circle"></i> Should I generate this app for you?
            </p>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="cancelVoiceGeneration()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn-confirm" onclick="confirmVoiceGeneration()">
                    <i class="fas fa-magic"></i> Yes, Generate App!
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentCode = '';
        let currentDevice = 'desktop';
        let recognition = null;
        let isRecording = false;
        let silenceTimeout = null;
        let finalTranscript = '';
        let pendingVoiceRequest = '';
        let microphonePermissionGranted = false;

        // Initialize Speech Recognition and request permission once
        async function initializeSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
                console.warn('Speech recognition not supported');
                return;
            }

            try {
                // Request microphone permission once
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                stream.getTracks().forEach(track => track.stop()); // Stop stream, we just needed permission
                microphonePermissionGranted = true;
                
                // Now initialize speech recognition
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onresult = (event) => {
                    // Clear the silence timeout since we got speech
                    clearTimeout(silenceTimeout);
                    
                    let interimTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript + ' ';
                        } else {
                            interimTranscript += transcript;
                        }
                    }
                    
                    // Update textarea with current transcript
                    const textarea = document.getElementById('appRequest');
                    textarea.value = (finalTranscript + interimTranscript).trim();
                    
                    // Set a new timeout for 5 seconds of silence
                    silenceTimeout = setTimeout(() => {
                        if (isRecording) {
                            stopVoiceInput();
                        }
                    }, 5000);
                };

                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    clearTimeout(silenceTimeout);
                    
                    // Handle specific errors
                    if (event.error === 'not-allowed') {
                        microphonePermissionGranted = false;
                        alert('Microphone access denied. Please allow microphone access in your browser settings and reload the page.');
                    } else if (event.error === 'no-speech') {
                        // Restart automatically on no-speech
                        if (isRecording) {
                            setTimeout(() => {
                                if (isRecording) {
                                    try { recognition.start(); } catch (e) {}
                                }
                            }, 100);
                        }
                    } else if (event.error !== 'aborted') {
                        stopVoiceInput();
                    }
                };

                recognition.onend = () => {
                    // Auto-restart if still recording (to maintain continuous listening)
                    if (isRecording) {
                        try {
                            recognition.start();
                        } catch (e) {
                            console.error('Failed to restart recognition:', e);
                            stopVoiceInput();
                        }
                    }
                };
                
                console.log('‚úÖ Microphone permission granted and always available');
                
            } catch (err) {
                console.error('Microphone permission denied:', err);
                alert('‚ùå Microphone access is required for voice input.\n\nPlease allow microphone access in your browser settings.');
                microphonePermissionGranted = false;
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Request permission automatically on load
            setTimeout(() => {
                initializeSpeechRecognition();
            }, 1000); // Small delay to let page fully load
        });

        // Toggle voice input
        function toggleVoiceInput() {
            if (!recognition) {
                if (!microphonePermissionGranted) {
                    alert('üé§ Microphone permission required!\n\nClick OK to grant permission, then try again.');
                    initializeSpeechRecognition();
                } else {
                    alert('Speech recognition is not supported in your browser. Please use Chrome, Edge, or Safari.');
                }
                return;
            }

            if (isRecording) {
                stopVoiceInput();
            } else {
                startVoiceInput();
            }
        }

        // Start voice input
        function startVoiceInput() {
            if (!recognition) {
                alert('Please wait for microphone initialization...');
                return;
            }

            isRecording = true;
            finalTranscript = '';
            clearTimeout(silenceTimeout);
            
            const voiceBtn = document.getElementById('voiceBtn');
            voiceBtn.classList.add('recording');
            voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
            voiceBtn.title = 'Stop Recording (or wait 5 sec of silence)';
            document.getElementById('appRequest').placeholder = 'üé§ Listening... speak now!';
            
            try {
                recognition.start();
            } catch (e) {
                // Already started, ignore
                console.log('Recognition already active');
            }
            
            // Set initial timeout for 5 seconds of silence
            silenceTimeout = setTimeout(() => {
                if (isRecording) {
                    stopVoiceInput();
                }
            }, 5000);
        }

        // Stop voice input
        function stopVoiceInput() {
            if (!isRecording) return;
            
            isRecording = false;
            clearTimeout(silenceTimeout);
            
            const voiceBtn = document.getElementById('voiceBtn');
            voiceBtn.classList.remove('recording');
            voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
            voiceBtn.title = 'Voice Input (Always Available)';
            document.getElementById('appRequest').placeholder = 'Example: Build me a todo app with dark mode and localStorage';
            
            if (recognition) {
                try {
                    recognition.stop();
                } catch (e) {
                    console.log('Recognition already stopped');
                }
            }
            
            // If we captured speech, show confirmation
            const request = document.getElementById('appRequest').value.trim();
            if (request) {
                pendingVoiceRequest = request;
                showConfirmationModal(request);
            }
            
            finalTranscript = '';
        }

        // Show confirmation modal
        function showConfirmationModal(request) {
            document.getElementById('voicePreview').textContent = '"' + request + '"';
            document.getElementById('confirmModal').classList.remove('hidden');
        }

        // Cancel voice generation
        function cancelVoiceGeneration() {
            document.getElementById('confirmModal').classList.add('hidden');
            pendingVoiceRequest = '';
        }

        // Confirm and generate app from voice
        function confirmVoiceGeneration() {
            document.getElementById('confirmModal').classList.add('hidden');
            if (pendingVoiceRequest) {
                document.getElementById('appRequest').value = pendingVoiceRequest;
                generateApp();
            }
            pendingVoiceRequest = '';
        }

        // Initialize trial manager
        let trialManager;
        document.addEventListener('DOMContentLoaded', () => {
            trialManager = new TrialManager('cortex', true); // true = build action
            trialManager.addRequestCounter();
        });

        // Generate App with AI - Enhanced with full workflow
        async function generateApp() {
            // Check trial requests
            if (trialManager && !trialManager.trackRequest()) {
                return; // Request blocked
            }

            const request = document.getElementById('appRequest').value.trim();
            if (!request) {
                alert('Please describe what you want to build!');
                return;
            }

            // Determine app type for size/file estimation
            const lower = request.toLowerCase();
            let appType = 'default';
            if (lower.includes('todo') || lower.includes('task')) appType = 'todo';
            else if (lower.includes('calc')) appType = 'calculator';
            else if (lower.includes('timer') || lower.includes('countdown')) appType = 'timer';
            else if (lower.includes('note')) appType = 'notes';
            else if (lower.includes('quiz')) appType = 'quiz';
            else if (lower.includes('weather')) appType = 'weather';
            else if (lower.includes('color')) appType = 'color';
            else if (lower.includes('portfolio')) appType = 'portfolio';
            else if (lower.includes('form') || lower.includes('contact')) appType = 'form';
            else if (lower.includes('counter')) appType = 'counter';
            else if (lower.includes('game')) appType = 'game';
            else if (lower.includes('chat')) appType = 'chat';
            else if (lower.includes('shop')) appType = 'shop';
            else if (lower.includes('blog')) appType = 'blog';
            else if (lower.includes('dashboard')) appType = 'dashboard';

            // Step 1: Inform user of file requirements
            const files = getFileRequirements(appType);
            const sizeMB = estimateAppSize(appType);
            document.getElementById('codeOutput').textContent = 
                `üì¶ App Requirements:\n‚Ä¢ Files: ${files.join(', ')}\n‚Ä¢ Estimated Size: ${sizeMB} MB\n\nChecking storage...`;
            await new Promise(resolve => setTimeout(resolve, 2000));

            // Step 2: Check storage space
            document.getElementById('codeOutput').textContent += '\n\nüíæ Checking available storage space...';
            const storage = await checkStorageSpace(sizeMB);
            await new Promise(resolve => setTimeout(resolve, 1000));

            // Step 3: Handle insufficient storage
            if (!storage.sufficient) {
                document.getElementById('codeOutput').textContent = 
                    `‚ùå Insufficient Storage!\n\n` +
                    `‚Ä¢ Available: ${storage.available.toFixed(2)} MB\n` +
                    `‚Ä¢ Required: ${storage.required} MB\n` +
                    `‚Ä¢ Please free up ${(storage.required - storage.available).toFixed(2)} MB to continue\n\n` +
                    `Tip: Clear browser cache or delete unused files.`;
                return;
            }

            document.getElementById('codeOutput').textContent += `\n‚úÖ Storage OK: ${storage.available.toFixed(2)} MB available`;
            await new Promise(resolve => setTimeout(resolve, 1000));

            // Step 4: Build complete app
            document.getElementById('codeOutput').textContent += '\n\nüî® Building app with all required files...';
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            currentCode = generateDemoApp(request);
            
            // Step 5: Debug and test
            document.getElementById('codeOutput').textContent += '\nüîç Debugging and testing app...';
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            const testResult = testGeneratedApp(currentCode);
            if (!testResult.valid) {
                document.getElementById('codeOutput').textContent += `\n‚ö†Ô∏è Test Warning: ${testResult.message}\nProceeding with deployment...`;
                await new Promise(resolve => setTimeout(resolve, 2000));
            } else {
                document.getElementById('codeOutput').textContent += '\n‚úÖ All tests passed!';
                await new Promise(resolve => setTimeout(resolve, 1000));
            }

            // Display code and update preview
            document.getElementById('codeOutput').textContent = currentCode;
            updatePreview(currentCode);
            
            // Auto-save to browser storage
            saveAppToHistory(request, appType, currentCode);

            // Step 6: Ask user to test in preview
            setTimeout(() => {
                alert('üéâ App Ready!\n\nPlease test it in the preview panel above ‚¨ÜÔ∏è\n\nTry all features to ensure it works as expected.');
            }, 500);

            // Step 7: Show deploy instruction after delay
            setTimeout(() => {
                const deployPrompt = confirm(
                    '‚úÖ Are you satisfied with the app?\n\n' +
                    'Click OK to see deploy instructions, or Cancel to make changes.'
                );
                if (deployPrompt) {
                    alert('üëá Click the "Deploy to Web" button below to download your app!\n\nThe button is in the green section at the bottom of the page.');
                }
            }, 8000);
        }

        // Storage check functions
        async function checkStorageSpace(requiredMB) {
            try {
                if (navigator.storage && navigator.storage.estimate) {
                    const estimate = await navigator.storage.estimate();
                    const availableMB = (estimate.quota - estimate.usage) / (1024 * 1024);
                    return {
                        available: availableMB,
                        required: requiredMB,
                        sufficient: availableMB > requiredMB
                    };
                }
                return { available: 1000, required: requiredMB, sufficient: true };
            } catch (e) {
                return { available: 1000, required: requiredMB, sufficient: true };
            }
        }

        function estimateAppSize(appType) {
            const sizes = {
                'todo': 0.5, 'calculator': 0.3, 'timer': 0.3, 'notes': 0.5, 'counter': 0.2,
                'quiz': 0.8, 'weather': 1.2, 'color': 0.4, 'portfolio': 2.5, 'form': 0.6,
                'game': 5.0, 'chat': 3.5, 'shop': 8.0, 'blog': 4.0, 'dashboard': 6.0,
                'default': 1.0
            };
            return sizes[appType] || sizes['default'];
        }

        function getFileRequirements(appType) {
            const requirements = {
                'todo': ['index.html'],
                'calculator': ['index.html'],
                'timer': ['index.html'],
                'notes': ['index.html'],
                'counter': ['index.html'],
                'quiz': ['index.html'],
                'weather': ['index.html'],
                'color': ['index.html'],
                'portfolio': ['index.html', 'style.css (embedded)', 'images (optional)'],
                'form': ['index.html'],
                'game': ['index.html', 'game.js (embedded)', 'assets (optional)'],
                'chat': ['index.html', 'chat.js (embedded)', 'styles (embedded)'],
                'shop': ['index.html', 'products.json (embedded)', 'cart.js (embedded)'],
                'blog': ['index.html', 'posts.json (embedded)', 'blog.css (embedded)'],
                'dashboard': ['index.html', 'charts.js (embedded)', 'data.json (embedded)'],
                'default': ['index.html']
            };
            return requirements[appType] || requirements['default'];
        }

        function testGeneratedApp(code) {
            try {
                if (!code.includes('<!DOCTYPE html>')) return { valid: false, message: 'Missing DOCTYPE' };
                if (!code.includes('</html>')) return { valid: false, message: 'Incomplete HTML' };
                const scriptCount = (code.match(/<script>/g) || []).length;
                const scriptCloseCount = (code.match(/<\/script>/g) || []).length;
                if (scriptCount !== scriptCloseCount) return { valid: false, message: 'Unclosed script tags' };
                if (code.length < 500) return { valid: false, message: 'App code too small' };
                return { valid: true, message: 'All checks passed' };
            } catch (e) {
                return { valid: false, message: e.message };
            }
        }

        // Generate demo app based on request
        function generateDemoApp(request) {
            const lower = request.toLowerCase();
            
            // Todo/Task apps
            if (lower.includes('todo') || lower.includes('task')) {
                return getTodoAppCode();
            }
            
            // Calculator
            if (lower.includes('calculator') || lower.includes('calc')) {
                return getCalculatorCode();
            }
            
            // Timer/Countdown
            if (lower.includes('timer') || lower.includes('countdown')) {
                return getTimerCode();
            }
            
            // Note taking
            if (lower.includes('note') || lower.includes('notepad')) {
                return getNoteAppCode();
            }
            
            // Quiz/Trivia
            if (lower.includes('quiz') || lower.includes('trivia') || lower.includes('test')) {
                return getQuizAppCode();
            }
            
            // Weather
            if (lower.includes('weather')) {
                return getWeatherAppCode();
            }
            
            // Color picker
            if (lower.includes('color') && (lower.includes('pick') || lower.includes('palette'))) {
                return getColorPickerCode();
            }
            
            // Portfolio/Landing
            if (lower.includes('portfolio') || lower.includes('landing')) {
                return getPortfolioCode(request);
            }
            
            // Form/Contact
            if (lower.includes('form') || lower.includes('contact')) {
                return getFormAppCode();
            }
            
            // Counter/Clicker
            if (lower.includes('counter') || lower.includes('clicker')) {
                return getCounterAppCode();
            }
            
            // Default smart app
            return getSmartDefaultApp(request);
        }

        // Keyboard shortcuts for modal
        document.addEventListener('keydown', (e) => {
            const modal = document.getElementById('confirmModal');
            if (!modal.classList.contains('hidden')) {
                if (e.key === 'Enter') {
                    confirmVoiceGeneration();
                } else if (e.key === 'Escape') {
                    cancelVoiceGeneration();
                }
            }
        });

        // Update preview frame
        function updatePreview(code) {
            const frame = document.getElementById('previewFrame');
            frame.srcdoc = code;
        }

        // Set device size
        function setDevice(device) {
            currentDevice = device;
            const frame = document.getElementById('previewFrame');
            const buttons = document.querySelectorAll('.device-btn');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.closest('.device-btn').classList.add('active');
            
            if (device === 'mobile') {
                frame.style.width = '375px';
                frame.style.margin = '0 auto';
            } else if (device === 'tablet') {
                frame.style.width = '768px';
                frame.style.margin = '0 auto';
            } else {
                frame.style.width = '100%';
            }
        }

        // Refresh preview
        function refreshPreview() {
            if (currentCode) updatePreview(currentCode);
        }

        // Open in new tab
        function openInNewTab() {
            if (!currentCode) {
                alert('Generate an app first!');
                return;
            }
            const blob = new Blob([currentCode], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            window.open(url, '_blank');
        }

        // Copy code
        function copyCode() {
            if (!currentCode) {
                alert('Generate an app first!');
                return;
            }
            navigator.clipboard.writeText(currentCode);
            alert('‚úÖ Code copied to clipboard!');
        }

        // Quick generate
        function quickGen(template) {
            document.getElementById('appRequest').value = template;
            generateApp();
        }

        // Deploy app with save location options
        async function deployApp() {
            if (!currentCode || currentCode.includes('// Your generated app')) {
                alert('Generate an app first before deploying!');
                return;
            }
            
            const appName = prompt('Enter a name for your app:', 'my-awesome-app');
            if (!appName) return;
            
            // Check if File System Access API is supported
            const supportsFileSystem = 'showSaveFilePicker' in window;
            
            if (supportsFileSystem) {
                // Show save dialog with location picker
                const saveChoice = confirm(
                    'üìÅ Save Location Options:\n\n' +
                    'OK = Choose custom location (recommended)\n' +
                    'Cancel = Save to default Downloads folder\n\n' +
                    'Choose custom location to save anywhere on your device!'
                );
                
                if (saveChoice) {
                    try {
                        // Use File System Access API for custom location
                        const handle = await window.showSaveFilePicker({
                            suggestedName: appName + '.html',
                            types: [{
                                description: 'HTML Files',
                                accept: { 'text/html': ['.html'] }
                            }]
                        });
                        
                        const writable = await handle.createWritable();
                        await writable.write(currentCode);
                        await writable.close();
                        
                        alert(
                            `‚úÖ App saved successfully!\n\n` +
                            `üìÇ Location: ${handle.name}\n` +
                            `üìç Saved to your chosen folder\n\n` +
                            `You can now:\n` +
                            `‚Ä¢ Open the file in any browser\n` +
                            `‚Ä¢ Upload to web hosting\n` +
                            `‚Ä¢ Share with others`
                        );
                        return;
                    } catch (err) {
                        if (err.name === 'AbortError') {
                            alert('‚ùå Save cancelled. Click Deploy again to try a different location.');
                            return;
                        }
                        console.error('Save error:', err);
                        alert('‚ö†Ô∏è Could not save to chosen location. Falling back to Downloads folder...');
                    }
                }
            }
            
            // Fallback: Download to default Downloads folder
            const blob = new Blob([currentCode], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = appName + '.html';
            a.click();
            URL.revokeObjectURL(url);
            
            // Show where file was saved
            const downloads = getDownloadsPath();
            alert(
                `üéâ App downloaded successfully!\n\n` +
                `üìÇ Saved to: ${downloads}\n` +
                `üìÑ File: ${appName}.html\n\n` +
                `Next steps:\n` +
                `‚Ä¢ Find the file in your Downloads folder\n` +
                `‚Ä¢ Double-click to open in browser\n` +
                `‚Ä¢ Upload to web hosting to deploy online`
            );
        }
        
        // Get expected Downloads folder path based on OS
        function getDownloadsPath() {
            const platform = navigator.platform.toLowerCase();
            if (platform.includes('win')) {
                return 'C:\\Users\\' + (navigator.userAgent.includes('Windows') ? 'YourUsername' : 'User') + '\\Downloads';
            } else if (platform.includes('mac')) {
                return '/Users/YourUsername/Downloads';
            } else if (platform.includes('linux')) {
                return '~/Downloads';
            }
            return 'Your Downloads folder';
        }
        
        // Auto-save app to browser storage
        function saveAppToHistory(request, appType, code) {
            try {
                let history = JSON.parse(localStorage.getItem('cortex_app_history') || '[]');
                
                // Add new app to history
                const app = {
                    id: Date.now(),
                    request: request,
                    type: appType,
                    code: code,
                    timestamp: new Date().toLocaleString(),
                    size: (code.length / 1024).toFixed(2) + ' KB'
                };
                
                history.unshift(app); // Add to beginning
                
                // Keep only last 20 apps
                if (history.length > 20) {
                    history = history.slice(0, 20);
                }
                
                localStorage.setItem('cortex_app_history', JSON.stringify(history));
            } catch (e) {
                console.warn('Could not save to history:', e);
            }
        }
        
        // Show saved apps modal
        function showSavedApps() {
            const history = JSON.parse(localStorage.getItem('cortex_app_history') || '[]');
            const modal = document.getElementById('savedAppsModal');
            const list = document.getElementById('savedAppsList');
            
            if (history.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:#94a3b8; padding:40px;">No saved apps yet. Generate an app to get started!</p>';
            } else {
                list.innerHTML = history.map(app => `
                    <div style="background: rgba(100, 116, 139, 0.1); border-left: 4px solid #9333ea; padding: 15px; margin-bottom: 10px; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <h4 style="color: #9333ea; margin-bottom: 5px;">${app.request}</h4>
                                <p style="color: #94a3b8; font-size: 12px; margin: 5px 0;">
                                    <i class="fas fa-tag"></i> ${app.type} ‚Ä¢ 
                                    <i class="fas fa-clock"></i> ${app.timestamp} ‚Ä¢ 
                                    <i class="fas fa-file"></i> ${app.size}
                                </p>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="loadSavedApp(${app.id})" style="padding: 8px 15px; background: #9333ea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                    <i class="fas fa-eye"></i> Load
                                </button>
                                <button onclick="downloadSavedApp(${app.id})" style="padding: 8px 15px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                    <i class="fas fa-download"></i> Save
                                </button>
                                <button onclick="deleteSavedApp(${app.id})" style="padding: 8px 15px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            modal.classList.remove('hidden');
        }
        
        // Close saved apps modal
        function closeSavedApps() {
            document.getElementById('savedAppsModal').classList.add('hidden');
        }
        
        // Load a saved app
        function loadSavedApp(id) {
            const history = JSON.parse(localStorage.getItem('cortex_app_history') || '[]');
            const app = history.find(a => a.id === id);
            
            if (app) {
                currentCode = app.code;
                document.getElementById('codeOutput').textContent = app.code;
                updatePreview(app.code);
                document.getElementById('appRequest').value = app.request;
                closeSavedApps();
                alert(`‚úÖ Loaded: ${app.request}\n\nReady to preview or deploy!`);
            }
        }
        
        // Download a saved app
        async function downloadSavedApp(id) {
            const history = JSON.parse(localStorage.getItem('cortex_app_history') || '[]');
            const app = history.find(a => a.id === id);
            
            if (app) {
                currentCode = app.code;
                await deployApp();
            }
        }
        
        // Delete a saved app
        function deleteSavedApp(id) {
            if (!confirm('Delete this app from history?')) return;
            
            let history = JSON.parse(localStorage.getItem('cortex_app_history') || '[]');
            history = history.filter(a => a.id !== id);
            localStorage.setItem('cortex_app_history', JSON.stringify(history));
            showSavedApps(); // Refresh list
        }

        // Demo app templates
        function getTodoAppCode() {
            return `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Todo App</title><style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.container{background:white;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);padding:40px;max-width:500px;width:100%}h1{color:#667eea;margin-bottom:30px;text-align:center}
.input-group{display:flex;gap:10px;margin-bottom:20px}input{flex:1;padding:15px;border:2px solid#e2e8f0;border-radius:10px;font-size:16px}input:focus{outline:none;border-color:#667eea}
button{padding:15px 30px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;border-radius:10px;cursor:pointer;font-weight:bold}button:hover{transform:translateY(-2px)}
.todo-item{background:#f8fafc;padding:15px;border-radius:10px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}.todo-item.done{opacity:0.6;text-decoration:line-through}
.delete{background:#ef4444;padding:5px 15px;border-radius:5px;font-size:12px}
</style></head><body><div class="container"><h1>üìù My Todo List</h1><div class="input-group"><input id="input" placeholder="What needs to be done?"/><button onclick="add()">Add</button></div><div id="list"></div></div><script>
let todos=JSON.parse(localStorage.getItem('todos')||'[]');function render(){document.getElementById('list').innerHTML=todos.map((t,i)=>\\\`<div class="todo-item \\\${t.done?'done':''}" onclick="toggle(\\\${i})"><span>\\\${t.text}</span><button class="delete" onclick="event.stopPropagation();del(\\\${i})">Delete</button></div>\\\`).join('')}
function add(){const input=document.getElementById('input');if(input.value.trim()){todos.push({text:input.value,done:false});input.value='';save();render()}}function toggle(i){todos[i].done=!todos[i].done;save();render()}
function del(i){todos.splice(i,1);save();render()}function save(){localStorage.setItem('todos',JSON.stringify(todos))}document.getElementById('input').onkeypress=e=>e.key==='Enter'&&add();render();
<\/script></body></html>`;
        }

        function getCalculatorCode() {
            return `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Calculator</title><style>
*{margin:0;padding:0;box-sizing:border-box}body{display:flex;align-items:center;justify-content:center;min-height:100vh;background:linear-gradient(135deg,#667eea,#764ba2);font-family:sans-serif}
.calc{background:#1e293b;border-radius:20px;padding:20px;box-shadow:0 20px 60px rgba(0,0,0,0.5);width:300px}.display{background:#0f172a;color:#10b981;font-size:32px;padding:20px;border-radius:10px;text-align:right;margin-bottom:20px;min-height:60px}
.buttons{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}button{padding:20px;font-size:20px;border:none;border-radius:10px;cursor:pointer;background:#334155;color:white}button:hover{background:#475569}
.operator{background:#667eea}.equals{background:#10b981;grid-column:span 2}.clear{background:#ef4444}
</style></head><body><div class="calc"><div class="display" id="display">0</div><div class="buttons">
<button onclick="append('7')">7</button><button onclick="append('8')">8</button><button onclick="append('9')">9</button><button class="operator" onclick="append('/')">√∑</button>
<button onclick="append('4')">4</button><button onclick="append('5')">5</button><button onclick="append('6')">6</button><button class="operator" onclick="append('*')">√ó</button>
<button onclick="append('1')">1</button><button onclick="append('2')">2</button><button onclick="append('3')">3</button><button class="operator" onclick="append('-')">‚àí</button>
<button onclick="append('0')">0</button><button onclick="append('.')">.</button><button class="equals" onclick="calc()">=</button><button class="operator" onclick="append('+')">+</button>
<button class="clear" onclick="clearAll()">C</button><button onclick="back()">‚å´</button>
</div></div><script>let d=document.getElementById('display'),c='0';function append(v){c=c==='0'?v:c+v;d.textContent=c}function clearAll(){c='0';d.textContent=c}
function back(){c=c.slice(0,-1)||'0';d.textContent=c}function calc(){try{c=eval(c).toString();d.textContent=c}catch{d.textContent='Error';c='0'}}<\/script></body></html>`;
        }

        function getTimerCode() {
            return `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Countdown Timer</title><style>
*{margin:0;padding:0;box-sizing:border-box}body{display:flex;align-items:center;justify-content:center;min-height:100vh;background:linear-gradient(135deg,#f093fb,#f5576c);font-family:sans-serif;text-align:center}
.container{background:white;padding:60px;border-radius:30px;box-shadow:0 20px 80px rgba(0,0,0,0.3)}h1{color:#f5576c;margin-bottom:40px}.timer{font-size:80px;font-weight:bold;color:#333;margin:30px 0}
button{padding:20px 40px;font-size:20px;border:none;border-radius:15px;cursor:pointer;margin:10px}.start{background:#10b981;color:white}.stop{background:#ef4444;color:white}
.reset{background:#6366f1;color:white}button:hover{transform:scale(1.05)}input{padding:15px;font-size:20px;border:2px solid#ddd;border-radius:10px;width:200px;text-align:center}
</style></head><body><div class="container"><h1>‚è±Ô∏è Countdown Timer</h1><input id="input" type="number" value="60"/><div class="timer" id="display">01:00</div>
<button class="start" onclick="start()">Start</button><button class="stop" onclick="stop()">Stop</button><button class="reset" onclick="reset()">Reset</button>
</div><script>let time=60,interval,running=false;function update(){let m=Math.floor(time/60),s=time%60;document.getElementById('display').textContent=\\\`\\\${m.toString().padStart(2,'0')}:\\\${s.toString().padStart(2,'0')}\\\`}
function start(){if(running)return;running=true;interval=setInterval(()=>{if(time>0){time--;update()}else{stop();alert('‚è∞ Time is up!')}},1000)}function stop(){running=false;clearInterval(interval)}
function reset(){stop();time=parseInt(document.getElementById('input').value)||60;update()}update();<\/script></body></html>`;
        }

        // Additional working app templates
        function getNoteAppCode() { 
            return `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Notes</title><style>*{margin:0;padding:0}body{font-family:sans-serif;background:linear-gradient(135deg,#ffecd2,#fcb69f);min-height:100vh;padding:20px}.container{max-width:800px;margin:0 auto;background:white;border-radius:20px;padding:30px}h1{color:#ff6b6b;margin-bottom:20px}textarea{width:100%;height:150px;padding:15px;border:2px solid#ffd93d;border-radius:10px;font-size:16px;margin-bottom:15px}.btn-group{display:flex;gap:10px;margin-bottom:20px}button{flex:1;padding:12px;background:#ff6b6b;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:bold}.note-item{background:#fff9e6;padding:15px;border-left:4px solid#ffd93d;margin-bottom:10px;border-radius:5px;position:relative}.note-item h3{color:#ff6b6b;margin-bottom:8px}.delete-note{position:absolute;top:10px;right:10px;background:#ff5252;color:white;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:12px}</style></head><body><div class="container"><h1>üìù Notes</h1><textarea id="noteInput" placeholder="Write your note..."></textarea><div class="btn-group"><button onclick="addNote()">üíæ Save</button><button onclick="clearAll()" style="background:#95a5a6">üóëÔ∏è Clear All</button></div><div id="notesList"></div></div><script>let notes=JSON.parse(localStorage.getItem('notes')||'[]');function render(){document.getElementById('notesList').innerHTML=notes.map((n,i)=>\\\`<div class="note-item"><h3>\\\${new Date(n.date).toLocaleString()}</h3><p>\\\${n.text}</p><button class="delete-note" onclick="deleteNote(\\\${i})">Delete</button></div>\\\`).join('')}function addNote(){const input=document.getElementById('noteInput');if(input.value.trim()){notes.unshift({text:input.value,date:Date.now()});input.value='';localStorage.setItem('notes',JSON.stringify(notes));render()}}function deleteNote(i){if(confirm('Delete?')){notes.splice(i,1);localStorage.setItem('notes',JSON.stringify(notes));render()}}function clearAll(){if(confirm('Delete all?')){notes=[];localStorage.setItem('notes',JSON.stringify(notes));render()}}render()<\/script></body></html>`; 
        }
        
        function getQuizAppCode() { 
            return `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Quiz</title><style>*{margin:0;padding:0}body{font-family:sans-serif;background:linear-gradient(135deg,#4facfe,#00f2fe);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}.container{background:white;border-radius:20px;padding:40px;max-width:600px;width:100%}h1{color:#4facfe;margin-bottom:30px;text-align:center}.question{font-size:20px;margin-bottom:20px;font-weight:bold}.options{display:flex;flex-direction:column;gap:12px}button{padding:15px;background:#f0f0f0;border:2px solid#ddd;border-radius:10px;cursor:pointer;font-size:16px;text-align:left}button:hover{background:#e0e0e0}button.correct{background:#10b981;color:white}button.wrong{background:#ef4444;color:white}.score{text-align:center;font-size:24px;color:#4facfe;font-weight:bold}.next-btn{width:100%;padding:15px;background:#4facfe;color:white;border:none;border-radius:10px;cursor:pointer;font-size:18px;font-weight:bold;margin-top:20px}</style></head><body><div class="container"><h1>üß† Quiz</h1><div id="quiz"></div></div><script>const questions=[{q:"2+2?",opts:["3","4","5","6"],ans:1},{q:"Capital of France?",opts:["Berlin","Madrid","Paris","Rome"],ans:2},{q:"Largest planet?",opts:["Earth","Mars","Jupiter","Saturn"],ans:2}];let current=0,score=0;function showQ(){const quiz=document.getElementById('quiz');if(current<questions.length){const q=questions[current];quiz.innerHTML=\\\`<div class="question">\\\${current+1}. \\\${q.q}</div><div class="options">\\\${q.opts.map((o,i)=>\\\`<button onclick="check(\\\${i})">\\\${o}</button>\\\`).join('')}</div>\\\`}else{quiz.innerHTML=\\\`<div class="score">üéâ Done!<br>Score: \\\${score}/\\\${questions.length}</div><button class="next-btn" onclick="location.reload()">Again</button>\\\`}}function check(sel){const q=questions[current];const btns=document.querySelectorAll('.options button');btns[q.ans].classList.add('correct');if(sel===q.ans){score++}else{btns[sel].classList.add('wrong')}btns.forEach(b=>b.disabled=true);setTimeout(()=>{current++;showQ()},1500)}showQ()<\/script></body></html>`; 
        }
        
        function getWeatherAppCode() { 
            return `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Weather</title><style>*{margin:0;padding:0}body{font-family:sans-serif;background:linear-gradient(135deg,#89f7fe,#66a6ff);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}.container{background:rgba(255,255,255,0.95);border-radius:20px;padding:40px;max-width:400px;width:100%;text-align:center}h1{color:#66a6ff;margin-bottom:20px}.search{display:flex;gap:10px;margin-bottom:30px}input{flex:1;padding:12px;border:2px solid#ddd;border-radius:10px;font-size:16px}button{padding:12px 20px;background:#66a6ff;color:white;border:none;border-radius:10px;cursor:pointer;font-weight:bold}.weather-icon{font-size:80px;margin:20px 0}.temp{font-size:60px;font-weight:bold}.details{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:30px}.detail-item{background:#f0f0f0;padding:15px;border-radius:10px}.detail-label{color:#999;font-size:12px;margin-bottom:5px}.detail-value{font-size:20px;font-weight:bold}</style></head><body><div class="container"><h1>‚õÖ Weather</h1><div class="search"><input id="city" value="London"/><button onclick="getWeather()">Search</button></div><div id="result"></div></div><script>function getWeather(){const city=document.getElementById('city').value;const temp=Math.floor(Math.random()*20+10);const hum=Math.floor(Math.random()*40+40);const wind=Math.floor(Math.random()*15+5);const icons=['‚òÄÔ∏è','‚òÅÔ∏è','üåßÔ∏è','‚õÖ'];const cond=['Sunny','Cloudy','Rainy','Partly Cloudy'];const idx=Math.floor(Math.random()*4);document.getElementById('result').innerHTML=\\\`<div class="weather-icon">\\\${icons[idx]}</div><div class="temp">\\\${temp}¬∞C</div><div class="condition" style="font-size:24px;margin:10px 0">\\\${cond[idx]}</div><h3 style="margin:20px 0;color:#66a6ff">\\\${city}</h3><div class="details"><div class="detail-item"><div class="detail-label">Humidity</div><div class="detail-value">\\\${hum}%</div></div><div class="detail-item"><div class="detail-label">Wind</div><div class="detail-value">\\\${wind} km/h</div></div></div>\\\`}getWeather()<\/script></body></html>`; 
        }
        
        function getColorPickerCode() { 
            return `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Color Picker</title><style>*{margin:0;padding:0}body{font-family:sans-serif;background:#1a1a1a;color:white;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}.container{background:#2a2a2a;border-radius:20px;padding:40px;max-width:500px;width:100%}h1{text-align:center;margin-bottom:30px}.color-display{height:200px;border-radius:15px;margin-bottom:30px}.controls{display:flex;flex-direction:column;gap:20px}.slider-group{background:#333;padding:20px;border-radius:10px}.slider-group label{display:flex;justify-content:space-between;margin-bottom:10px}input[type="range"]{width:100%;height:8px;border-radius:5px}.color-code{background:#1a1a1a;padding:15px;border-radius:10px;text-align:center;font-family:monospace;font-size:24px;margin-top:20px;cursor:pointer}button{width:100%;padding:15px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;border-radius:10px;cursor:pointer;font-size:16px;font-weight:bold;margin-top:20px}</style></head><body><div class="container"><h1>üé® Color Picker</h1><div id="colorDisplay" class="color-display"></div><div class="controls"><div class="slider-group"><label>Red: <span id="rVal">128</span></label><input type="range" min="0" max="255" value="128" oninput="update()"/></div><div class="slider-group"><label>Green: <span id="gVal">128</span></label><input type="range" min="0" max="255" value="128" oninput="update()"/></div><div class="slider-group"><label>Blue: <span id="bVal">128</span></label><input type="range" min="0" max="255" value="128" oninput="update()"/></div></div><div class="color-code" id="code" onclick="navigator.clipboard.writeText(document.getElementById('code').textContent);alert('Copied!')">#808080</div><button onclick="document.querySelectorAll('input').forEach(i=>i.value=Math.random()*256);update()">Random</button></div><script>function update(){const inputs=document.querySelectorAll('input[type=range]');const r=inputs[0].value,g=inputs[1].value,b=inputs[2].value;document.getElementById('rVal').textContent=r;document.getElementById('gVal').textContent=g;document.getElementById('bVal').textContent=b;const hex='#'+[r,g,b].map(x=>parseInt(x).toString(16).padStart(2,'0')).join('');document.getElementById('colorDisplay').style.background=hex;document.getElementById('code').textContent=hex}update()<\/script></body></html>`; 
        }
        
        function getPortfolioCode() { 
            return `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Portfolio</title><style>*{margin:0;padding:0}body{font-family:sans-serif;background:#0a0a0a;color:white}.hero{min-height:100vh;display:flex;align-items:center;justify-content:center;text-align:center;background:linear-gradient(135deg,#667eea,#764ba2);padding:20px}.hero h1{font-size:60px;margin-bottom:20px}.hero p{font-size:24px;margin-bottom:40px}.btn{padding:15px 40px;background:white;color:#667eea;border:none;border-radius:50px;font-size:18px;font-weight:bold;text-decoration:none;display:inline-block}.section{padding:80px 20px;max-width:1200px;margin:0 auto}.section h2{font-size:40px;margin-bottom:40px;text-align:center}.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:30px}.card{background:#1a1a1a;padding:30px;border-radius:15px;transition:transform 0.3s}.card:hover{transform:translateY(-10px)}.card h3{color:#667eea;margin-bottom:15px}.card p{color:#aaa;line-height:1.6}</style></head><body><div class="hero"><div><h1>üëã Hello, I'm [Your Name]</h1><p>Web Developer & Designer</p><a href="#projects" class="btn">View Work</a></div></div><div class="section" id="projects"><h2>My Projects</h2><div class="grid"><div class="card"><h3>üöÄ Project One</h3><p>Modern web app with real-time features and responsive design</p></div><div class="card"><h3>üíº Project Two</h3><p>E-commerce platform with payments and analytics</p></div><div class="card"><h3>üé® Project Three</h3><p>Portfolio with smooth animations and interactions</p></div></div></div></body></html>`; 
        }
        
        function getFormAppCode() { 
            return `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Contact</title><style>*{margin:0;padding:0}body{font-family:sans-serif;background:linear-gradient(135deg,#e0c3fc,#8ec5fc);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}.container{background:white;border-radius:20px;padding:40px;max-width:500px;width:100%}h1{color:#8ec5fc;margin-bottom:30px;text-align:center}.form-group{margin-bottom:20px}label{display:block;margin-bottom:8px;font-weight:bold}input,textarea{width:100%;padding:12px;border:2px solid#ddd;border-radius:10px;font-size:16px}textarea{resize:vertical;min-height:120px}button{width:100%;padding:15px;background:linear-gradient(135deg,#e0c3fc,#8ec5fc);color:white;border:none;border-radius:10px;font-size:18px;font-weight:bold;cursor:pointer}.success{background:#10b981;color:white;padding:15px;border-radius:10px;text-align:center;margin-top:20px;display:none}</style></head><body><div class="container"><h1>üìß Contact</h1><form onsubmit="event.preventDefault();document.getElementById('success').style.display='block';setTimeout(()=>document.getElementById('success').style.display='none',3000);this.reset()"><div class="form-group"><label>Name:</label><input required/></div><div class="form-group"><label>Email:</label><input type="email" required/></div><div class="form-group"><label>Message:</label><textarea required></textarea></div><button>Send</button></form><div class="success" id="success">‚úÖ Message sent!</div></div></body></html>`; 
        }
        
        function getCounterAppCode() { 
            return `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Counter</title><style>*{margin:0;padding:0}body{font-family:sans-serif;background:linear-gradient(135deg,#f093fb,#f5576c);min-height:100vh;display:flex;align-items:center;justify-content:center}.container{background:white;border-radius:30px;padding:60px;text-align:center}h1{color:#f5576c;margin-bottom:40px}.counter{font-size:120px;font-weight:bold;margin:40px 0}.buttons{display:flex;gap:15px;margin-top:30px}button{padding:20px 40px;font-size:24px;border:none;border-radius:15px;cursor:pointer;font-weight:bold;min-width:120px}.add{background:#10b981;color:white}.subtract{background:#ef4444;color:white}.reset{background:#6366f1;color:white}</style></head><body><div class="container"><h1>üî¢ Counter</h1><div class="counter" id="c">0</div><div class="buttons"><button class="subtract" onclick="change(-1)">-</button><button class="reset" onclick="document.getElementById('c').textContent=localStorage.count=0">Reset</button><button class="add" onclick="change(1)">+</button></div></div><script>let count=parseInt(localStorage.count)||0;document.getElementById('c').textContent=count;function change(v){count+=v;document.getElementById('c').textContent=count;localStorage.count=count}<\/script></body></html>`; 
        }
        
        function getSmartDefaultApp(request) { 
            const lower = request.toLowerCase();
            let emoji = 'üéØ', desc = `Your ${request} app`;
            if (lower.includes('game')) { emoji = 'üéÆ'; desc = 'Interactive game'; }
            else if (lower.includes('chat')) { emoji = 'üí¨'; desc = 'Messaging platform'; }
            else if (lower.includes('shop')) { emoji = 'üõí'; desc = 'E-commerce platform'; }
            else if (lower.includes('blog')) { emoji = 'üìù'; desc = 'Content system'; }
            else if (lower.includes('dashboard')) { emoji = 'üìä'; desc = 'Analytics dashboard'; }
            return `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>${request}</title><style>*{margin:0;padding:0}body{font-family:sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;padding:20px}.container{max-width:1000px;margin:0 auto;background:white;border-radius:20px;padding:40px}.header{text-align:center;margin-bottom:40px}h1{color:#667eea;font-size:42px;margin-bottom:15px}.emoji{font-size:60px;margin-bottom:20px}.features{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:25px;margin:40px 0}.feature-card{background:#f8f9fa;padding:25px;border-radius:15px;border-left:4px solid#667eea}.feature-card h3{color:#667eea;margin-bottom:10px}.cta{text-align:center;margin-top:40px}button{padding:18px 50px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;border-radius:50px;font-size:18px;font-weight:bold;cursor:pointer}</style></head><body><div class="container"><div class="header"><div class="emoji">${emoji}</div><h1>${request}</h1><p>${desc}</p></div><div class="features"><div class="feature-card"><h3>‚ú® Core Features</h3><p>Powerful functionality with modern design</p></div><div class="feature-card"><h3>üöÄ Performance</h3><p>Fast and responsive experience</p></div><div class="feature-card"><h3>üí° Smart Tools</h3><p>Enhanced productivity features</p></div></div><div class="cta"><button onclick="alert('Welcome! This is a customizable template ready to build upon.')">Get Started</button></div></div></body></html>`;
        }

        function getDefaultAppCode(request) {
            return getSmartDefaultApp(request);
        }
    </script>
</body>
</html>
