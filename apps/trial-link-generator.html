<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trial Link Generator - Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body class="min-h-screen p-6">
    <div class="max-w-4xl mx-auto">
        <!-- Admin Check -->
        <div id="adminCheck" class="glass rounded-2xl p-8 text-white text-center">
            <i class="fas fa-lock text-6xl mb-4 text-purple-400"></i>
            <h1 class="text-3xl font-bold mb-4">Admin Authentication</h1>
            <input type="email" id="adminEmail" placeholder="Enter your email" 
                   class="w-full max-w-md mx-auto px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white mb-4">
            <button onclick="checkAdmin()" class="bg-purple-600 px-8 py-3 rounded-lg font-bold hover:bg-purple-700">
                <i class="fas fa-sign-in-alt mr-2"></i> Login as Admin
            </button>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="hidden">
            <div class="glass rounded-2xl p-8 text-white mb-6">
                <h1 class="text-3xl font-bold mb-2"><i class="fas fa-link mr-3"></i> Tester Link Generator</h1>
                <p class="text-gray-400">Create shareable tester links for iOS & Android</p>
            </div>

            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <!-- Link Generator -->
                <div class="glass rounded-xl p-6 text-white">
                    <h2 class="text-xl font-bold mb-4"><i class="fas fa-magic mr-2"></i> Generate Trial Link</h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block mb-2 text-sm">Access Type</label>
                            <select id="trialType" class="w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white">
                                <option value="tester">Tester Access (3 builds + 10 chats)</option>
                                <option value="paid">Paid License (Unlimited)</option>
                                <option value="admin">Admin Access (Full)</option>
                            </select>
                        </div>

                        <div>
                            <label class="block mb-2 text-sm">Apps to Include</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" id="app_alien" checked class="mr-2">
                                    <span>Alien AI Assistant</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="app_cortex" checked class="mr-2">
                                    <span>Cortex App Studio</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="app_nokn" checked class="mr-2">
                                    <span>No Knowledge Kit</span>
                                </label>
                            </div>
                        </div>

                        <button onclick="generateLink()" class="w-full bg-purple-600 py-3 rounded-lg font-bold hover:bg-purple-700">
                            <i class="fas fa-link mr-2"></i> Generate Link
                        </button>
                    </div>
                </div>

                <!-- Generated Links -->
                <div class="glass rounded-xl p-6 text-white">
                    <h2 class="text-xl font-bold mb-4"><i class="fas fa-clipboard-list mr-2"></i> Generated Links</h2>
                    <div id="linkOutput" class="space-y-4"></div>
                </div>
            </div>

            <!-- Trial Statistics -->
            <div class="glass rounded-xl p-6 text-white">
                <h2 class="text-xl font-bold mb-4"><i class="fas fa-chart-bar mr-2"></i> Active Trials</h2>
                <div id="trialStats"></div>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_EMAIL = 'mr.troy.walker.62@gmail.com';

        function checkAdmin() {
            const email = document.getElementById('adminEmail').value.trim().toLowerCase();
            
            if (email === ADMIN_EMAIL) {
                localStorage.setItem('master_admin', 'TROY_WALKER_2026');
                document.getElementById('adminCheck').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                loadTrialStats();
            } else {
                alert('‚ùå Unauthorized. Admin access only.');
            }
        }

        function generateLink() {
            const trialType = document.getElementById('trialType').value;
            
            const apps = [];
            if (document.getElementById('app_alien').checked) apps.push('alien');
            if (document.getElementById('app_cortex').checked) apps.push('cortex');
            if (document.getElementById('app_nokn').checked) apps.push('nokn');
            
            if (apps.length === 0) {
                alert('Please select at least one app!');
                return;
            }
            
            // Generate unique trial key
            const trialKey = 'TRIAL-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9).toUpperCase();
            
            // Create shareable link
            const baseUrl = window.location.origin + window.location.pathname.replace('trial-link-generator.html', '');
            const trialLink = `${baseUrl}trial-activate.html?key=${trialKey}&apps=${apps.join(',')}&type=${trialType}`;
            
            // Save link data
            const linkData = {
                key: trialKey,
                type: trialType,
                apps: apps,
                createdAt: new Date().toISOString(),
                createdBy: ADMIN_EMAIL,
                usedBy: null,
                active: true
            };
            
            let trialLinks = JSON.parse(localStorage.getItem('trial_links') || '[]');
            trialLinks.push(linkData);
            localStorage.setItem('trial_links', JSON.stringify(trialLinks));
            
            // Display links
            displayLinks(trialLink, trialKey);
        }

        function displayLinks(link, key) {
            const output = document.getElementById('linkOutput');
            
            const linkHtml = `
                <div class="bg-white/5 rounded-lg p-4 border border-white/10">
                    <p class="text-xs text-gray-400 mb-2">Key: ${key}</p>
                    <input type="text" value="${link}" readonly 
                           class="w-full px-3 py-2 rounded bg-white/10 text-sm mb-2 border border-white/20">
                    <div class="flex gap-2">
                        <button onclick="copyLink('${link}')" class="flex-1 bg-green-600 px-3 py-2 rounded text-sm hover:bg-green-700">
                            <i class="fas fa-copy mr-1"></i> Copy Link
                        </button>
                        <button onclick="shareViaEmail('${link}')" class="flex-1 bg-blue-600 px-3 py-2 rounded text-sm hover:bg-blue-700">
                            <i class="fas fa-envelope mr-1"></i> Email
                        </button>
                    </div>
                    <div class="mt-3 pt-3 border-t border-white/10 space-y-1">
                        <p class="text-xs"><i class="fas fa-mobile-alt mr-2"></i> iOS Compatible ‚úÖ</p>
                        <p class="text-xs"><i class="fas fa-android mr-2"></i> Android Compatible ‚úÖ</p>
                    </div>
                </div>
            `;
            
            output.innerHTML = linkHtml + output.innerHTML;
        }

        function copyLink(link) {
            navigator.clipboard.writeText(link);
            alert('‚úÖ Link copied to clipboard!');
        }

        function shareViaEmail(link) {
            const subject = 'Your Tester Access to PAPI Central Apps!';
            const body = `You've been invited to test PAPI Central premium apps!\n\n` +
                        `üéØ Tester Benefits\n` +
                        `‚úÖ 3 app builds (Cortex, Alien AI, No Knowledge Kit)\n` +
                        `‚úÖ 10 chat sessions initially\n` +
                        `‚úÖ Complete survey: +20 chats\n` +
                        `‚úÖ Share with 5 friends: +3 builds\n` +
                        `‚úÖ Total possible: 6 builds + 30 chats\n\n` +
                        `Activate your tester access: ${link}\n\n` +
                        `Works on iOS & Android!`;
            
            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }

        function loadTrialStats() {
            const trials = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('trial_')) {
                    const data = JSON.parse(localStorage.getItem(key));
                    trials.push(data);
                }
            }
            
            const statsDiv = document.getElementById('trialStats');
            if (trials.length === 0) {
                statsDiv.innerHTML = '<p class="text-gray-400 text-center py-8">No active trials yet</p>';
                return;
            }
            
            statsDiv.innerHTML = trials.map(t => `
                <div class="bg-white/5 rounded-lg p-4 mb-3 border border-white/10">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-bold">${t.name}</p>
                            <p class="text-sm text-gray-400">${t.email}</p>
                            <p class="text-xs text-gray-500 mt-1">Expires: ${new Date(t.expiresAt).toLocaleDateString()}</p>
                        </div>
                        <div class="text-right text-xs">
                            <p>üî® Builds: ${t.buildsRemaining.alien + t.buildsRemaining.cortex + t.buildsRemaining.nokn}</p>
                            <p>üí¨ Chats: ${t.chatsRemaining.alien + t.chatsRemaining.cortex + t.chatsRemaining.nokn}</p>
                            <p class="text-gray-500">${t.surveyCompleted ? '‚úÖ Survey' : '‚è≥ Survey'} ${t.socialShared ? '‚úÖ Shared' : '‚è≥ Share'}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Check if admin on load
        if (localStorage.getItem('master_admin') === 'TROY_WALKER_2026') {
            document.getElementById('adminEmail').value = ADMIN_EMAIL;
            checkAdmin();
        }
    </script>
</body>
</html>
