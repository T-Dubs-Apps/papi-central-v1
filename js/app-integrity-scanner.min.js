let scanBtn=document.getElementById("scanBtn");const scanResults=document.getElementById("scanResults"),repairBox=document.getElementById("repairBox"),reminder=document.getElementById("reminder"),statusDiv=document.getElementById("status");let issuesFound=!1;async function scanAllApps(){scanResults.innerHTML="<div>Scanning all apps...</div>",statusDiv.textContent="";try{const e=await fetch("http://localhost:5050/scan-apps"),t=(await e.json()).issues||[];issuesFound=t.length>0,scanResults.innerHTML="<b>Scan Results:</b><ul>"+t.map(e=>`<li><b>${e.app}:</b> ${e.issue} <button class='ml-2 bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded text-xs' onclick='repairIssue("${e.app}", "${e.fix}")'>Repair</button></li>`).join("")+"</ul>",issuesFound&&(reminder.textContent="Reminder: Issues found! Please review and repair.")}catch(e){scanResults.innerHTML=`<div>Error scanning apps: ${e.message}</div>`}}async function autoConfigureKeys(e,t){try{const n=await fetch("http://localhost:5050/configure-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({app:e,api_key:t})});await n.json();statusDiv.textContent=`API key configured for ${e}.`}catch(e){statusDiv.textContent=`Error configuring API key: ${e.message}`}}window.repairIssue=async function(e,t){repairBox.innerHTML=`<div>Repairing <b>${e}</b>: ${t}...</div>`;try{const n=await fetch("http://localhost:5050/repair-app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({app:e,fix:t})});await n.json();repairBox.innerHTML=`<div><b>${e}</b> repaired: ${t} applied.</div>`,statusDiv.textContent=`${e} is now enhanced.`,scanResults.querySelectorAll("button").forEach(e=>e.disabled=!0),reminder.textContent=""}catch(e){repairBox.innerHTML=`<div>Error repairing app: ${e.message}</div>`}},scanBtn.onclick=scanAllApps,"1"===localStorage.getItem("appIntegrityReminder")&&(reminder.textContent="Reminder: Issues found! Please review and repair."),window.autoConfigureKeys=autoConfigureKeys;