let lastZip=null;async function scanAndUpgrade(){const t=document.getElementById("folderInput"),e=document.getElementById("output");if(!t.files.length)return void(e.textContent="Please select a folder to scan.");e.textContent="Zipping files for upload...";const n=await createZip(t.files);lastZip=n,e.textContent="Uploading to AI backend...";const o=new FormData;o.append("file",n,"app.zip");try{const t=await fetch("http://localhost:5050/analyze",{method:"POST",body:o}),n=await t.json();let a="AI Upgrade Report:\n";n.report&&(a+=n.report.join("\n")),n.repairs&&n.repairs.length&&(a+="\n\nFiles repaired by AI:\n"+n.repairs.join(", ")),e.textContent=a}catch(t){e.textContent="Error contacting backend: "+t}}async function undoUpgrade(){const t=document.getElementById("output");if(!lastZip)return void(t.textContent="No previous upgrade to undo.");t.textContent="Restoring previous state...";const e=new FormData;e.append("file",lastZip,"app.zip"),e.append("undo","true");try{const n=await fetch("http://localhost:5050/analyze",{method:"POST",body:e});await n.json();t.textContent="Undo complete. Previous state restored."}catch(e){t.textContent="Error restoring previous state: "+e}}async function createZip(t){if("undefined"==typeof JSZip)throw alert("JSZip library required for zipping files."),new Error("JSZip not loaded");const e=new JSZip;for(const n of t)e.file(n.webkitRelativePath,await n.arrayBuffer());return await e.generateAsync({type:"blob"})}